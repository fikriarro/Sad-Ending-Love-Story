<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROYYAN DOCUMENT SCANNER</title>

<link href="https://unpkg.com/cropperjs/dist/cropper.css" rel="stylesheet">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 15px;
}

h2 { text-align: center; }

button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  background: #1e88e5;
  color: white;
}

button.secondary {
  background: #43a047;
}

img {
  max-width: 100%;
  margin-top: 12px;
  border-radius: 6px;
  display: none;
}

.section {
  margin-top: 15px;
}
</style>
</head>

<body>

<h2>ROYYAN DOCUMENT SCANNER</h2>

<input type="file" accept="image/*" capture="environment" id="cameraInput" hidden>
<input type="file" accept="image/*" id="galleryInput" hidden>

<div class="section">
  <button onclick="cameraInput.click()">üì∑ Ambil dari Kamera</button>
  <button class="secondary" onclick="galleryInput.click()">üñºÔ∏è Ambil dari Galeri</button>
</div>

<img id="preview">

<div class="section">
  <button id="cropBtn" disabled>‚úÇÔ∏è Crop Dokumen</button>
</div>

<div class="section">
  <button id="saveCropBtn" style="display:none;">‚úÖ Simpan Crop</button>
  <button id="reCropBtn" style="display:none;">üîÅ Crop Ulang</button>
</div>

<div class="section">
  <p><b>Hasil Crop:</b></p>
  <img id="result">
</div>

<script src="https://unpkg.com/cropperjs/dist/cropper.js"></script>

<script>
let cropper;
const cameraInput = document.getElementById("cameraInput");
const galleryInput = document.getElementById("galleryInput");
const preview = document.getElementById("preview");
const cropBtn = document.getElementById("cropBtn");
const saveCropBtn = document.getElementById("saveCropBtn");
const reCropBtn = document.getElementById("reCropBtn");
const result = document.getElementById("result");

function handleFile(file) {
  const reader = new FileReader();
  reader.onload = () => {
    preview.src = reader.result;
    preview.style.display = "block";
    cropBtn.disabled = false;
    result.style.display = "none";
    saveCropBtn.style.display = "none";
    reCropBtn.style.display = "none";

    if (cropper) cropper.destroy();
  };
  reader.readAsDataURL(file);
}

cameraInput.onchange = e => handleFile(e.target.files[0]);
galleryInput.onchange = e => handleFile(e.target.files[0]);

cropBtn.onclick = () => {
  cropper = new Cropper(preview, {
    viewMode: 1,
    autoCropArea: 0.9,
    movable: true,
    zoomable: true
  });
  saveCropBtn.style.display = "block";
};

saveCropBtn.onclick = () => {
  const canvas = cropper.getCroppedCanvas({ imageSmoothingQuality: "high" });
  result.src = canvas.toDataURL("image/jpeg", 0.85);
  result.style.display = "block";

  cropper.destroy();
  cropper = null;

  saveCropBtn.style.display = "none";
  reCropBtn.style.display = "block";
};

reCropBtn.onclick = () => {
  cropper = new Cropper(preview, {
    viewMode: 1,
    autoCropArea: 0.9
  });

  saveCropBtn.style.display = "block";
  reCropBtn.style.display = "none";
};
</script>

</body>
</html>
