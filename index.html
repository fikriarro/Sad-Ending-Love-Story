<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Document Scanner</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  text-align:center;
  padding:20px;
}

button {
  padding:10px 16px;
  margin:6px;
  border:none;
  border-radius:6px;
  background:#2563eb;
  color:white;
  font-size:15px;
}

button.secondary {
  background:#6b7280;
}

#preview {
  max-width:100%;
  margin-top:15px;
  border-radius:6px;
  display:none;
}

.filter button {
  background:#10b981;
}

canvas {
  display:none;
}
</style>
</head>

<body>

<h2> Roy Document Scanner</h2>

<input type="file" accept="image/*" capture="environment" id="camera" hidden>
<input type="file" accept="image/*" id="gallery" hidden>

<button onclick="camera.click()">üì∑ Kamera</button>
<button onclick="gallery.click()">üñºÔ∏è Galeri</button>

<img id="preview">

<div class="filter" id="filters" style="display:none">
  <p>Pilih mode warna</p>
  <button onclick="applyFilter('normal')">Asli</button>
  <button onclick="applyFilter('clear')">Jernih</button>
  <button onclick="applyFilter('bright')">Terang</button>
  <button onclick="applyFilter('bw')">Hitam Putih</button>
</div>

<br>
<button class="secondary" onclick="savePage()" id="saveBtn" style="display:none">
Simpan Halaman
</button>

<br><br>
<button onclick="downloadPDF()">Download PDF</button>

<p id="count">0 halaman</p>

<canvas id="canvas"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const camera = document.getElementById("camera");
const gallery = document.getElementById("gallery");
const preview = document.getElementById("preview");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let originalImage = new Image();
let pages = [];

camera.onchange = handleFile;
gallery.onchange = handleFile;

function handleFile(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = ev => {
    originalImage.src = ev.target.result;
    preview.src = ev.target.result;
    preview.style.display = "block";
    document.getElementById("filters").style.display = "block";
    document.getElementById("saveBtn").style.display = "inline-block";
  };
  reader.readAsDataURL(file);
}

function applyFilter(type) {
  canvas.width = 794;
  canvas.height = 1123;

  ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
  let img = ctx.getImageData(0,0,canvas.width,canvas.height);
  let d = img.data;

  for(let i=0;i<d.length;i+=4){
    let r=d[i], g=d[i+1], b=d[i+2];

    if(type==="bw"){
      let avg=(r+g+b)/3;
      d[i]=d[i+1]=d[i+2]=avg;
    }

    if(type==="bright"){
      d[i]=Math.min(r+40,255);
      d[i+1]=Math.min(g+40,255);
      d[i+2]=Math.min(b+40,255);
    }

    if(type==="clear"){
      d[i]=Math.min(r*1.2,255);
      d[i+1]=Math.min(g*1.2,255);
      d[i+2]=Math.min(b*1.2,255);
    }
  }

  ctx.putImageData(img,0,0);
  preview.src = canvas.toDataURL("image/jpeg",0.7);
}

function savePage(){
  pages.push(preview.src);
  document.getElementById("count").innerText =
    pages.length + " halaman tersimpan";

  preview.style.display="none";
  document.getElementById("filters").style.display="none";
  document.getElementById("saveBtn").style.display="none";
}

function downloadPDF(){
  if(pages.length===0){
    alert("Belum ada halaman");
    return;
  }

  const pdf = new jspdf.jsPDF("p","pt","a4");
  pages.forEach((img,i)=>{
    if(i>0) pdf.addPage();
    pdf.addImage(img,"JPEG",0,0,595,842);
  });

  pdf.save("document.pdf");
}
</script>

</body>
</html>
